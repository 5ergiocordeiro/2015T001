# Histórico
Projeto 2015T001: Relatório de totalizações do Fix32 para a Gerdau

* 14/04/2015
+ Reunião com Michael e Sady
++ Informações e definiçãoes preliminares
+++ O Michael já havia montado uma máquina virtual e conseguido comunicar o Fix32 com o Excel via DDE,
+++ Deve ser desenvolvido um aplicativo para aquisição contínua dos dados, totalização e confecção de um relatório.
+++ Discutiram-se alguns detalhes do algoritmo a ser usado.
+++ O aplicativo rodará em Windows XP no servidor, mas será testado no cliente.
+++ A linguagem de programação a ser usada não foi definida.
+++ Pesquisar a melhor maneira de conectar-se ao Fix32 (DDE, OLE, ODBC).
+++ Copiei a máquina virtual para trabalhar
++ Contato por telefone à noite
+++ Negociação do valor a ser pago.
+++ A data de entrega foi combinada: 22/04/2015.
+++ Decidiu-se que o tratamento dos erros será o mais simples possível.
++ **Algoritmo definido:**
+++ Ao partir, verificar se já existe um arquivo para registro das leituras;
+++ Se existir, tentar recuperar os dados; caso contrário, recriar o arquivo;
+++ Ler os dados continuamente;
+++ Registrar no arquivo;
+++ Integrar no tempo;
+++ Ao final do dia, gravar os totais em outro arquivo;
+++ Mudar o arquivo para registro dos valores;
+++ Ao final do mês, gerar o relatório a partir dos totais diários registrados.
+++ Periodicamente, apagar os arquivos temporários.

* 15/04/2015
+ Pesquisa na Internet
++ Descobri que o Fix32 não funciona como servidor ODBC.
++ Não encontrei muita coisa sobre comunicação via OLE.
++ Encontrei informação a respeito de uso de OPC com o Fix32, tendo como cliente o Excel.
++ Encontrei informação a respeito de uso de DDE com o Fix32, tendo como clientes o Excel e o C++.
++ Descobri que há duas tecnologias próprias do Fix32 que podem ser usadas, o EDA (Easy data Access) e o HDC Report, mas não aprofundei a pesquisa.
+ Investigação da máquina virtual
++ O único arquivo de biblioteca de tipos que existe no disco é o OPCDRV.TLB, que corresponde à Intellution OPC Client 7.10 Lybrary.
++ De acordo com a documentação, os arquivos interfacedef.h e interfacedef.obj são necessários para interface do servidor OPC com um cliente C++; esses arquivos não existem no disco.
++ Experimentei a programação da interface com o Fix32 via DDE pelo VBA, sem problemas.
++ Experimentei a programação da interface com o Fix32 via OPC pelo VBA.
+++ Descobri como deve ser o código e esbocei a solução.
+++ Descobri que o OPC Data Access 2.0 Server for iFix (OPC20iFix) não estava instalado na máquina, apesar de aparecer na lista de servidores montada pelo PowerTool.
+++ Descobri que apenas o Intellution OPC Server (OPCEDA) estava instalado na máquina; ele funciona apenas localmente, mas pode ser usado na solução.
+++ Tentei usar o OPCEDA com o PowerTool, mas ele travou durante o browsing.
+++ Consegui usar o OPCEDA com o VBA.
+++ Imagino que na máquina servidora o Workspace estaria disponível, portanto seria possível implementar uma comunicação via OLE Automation, mas não consegui confirmar essa suposição.
++ **Em vista de tudo isso, tracei o caminho a seguir:**
+++ Desenvolver o aplicativo usando DDE e C++;
+++ Desenvolver uma alternativa usando OPC e VBA;
+++ Obter os arquivos que faltam para usar OPC e C++;

* 19/04/2015
+ Iniciei a programação
++ Criei repositório no Github
++ Esbocei a janela para exibição do resultado
++ Comecei a implementar a comunicação via DDE
++ Usei o servidor DDE do Excel para experiências
+++ * Descobri o nome da janela que executa o servidor DDE do Fix32 *
+ Testes
++ Testei a execução do aplicativo na máquina virtual
++ Instalei o GTK+ 3 na máquina virtual
++ * Ajustei os parâmetros para compilação *

* 20/04/2015
+ Prossegui com a pogramação
++ Descobri diversas coisas:
+++ como obter o handle da janela Windows a partir do GTK
+++ como interceptar o procedimento da janela Windows
+++ como é a convenção para comunicação com o servidor DDE do Excel
+++ como funciona a troca de mensagens com DDE
++ * Consegui ler dados do Excel como servidor DDE *

* 21/04/2015
+ Prossegui com a pogramação
++ Arrumei o código e fiz mais testes
++ Estão acontecendo coisas inesperadas:
+++ o Excel envia ACK como resposta à mensagem WM_DDE_ADVISE
+++ a aplicação aborta quando leio mais de uma variável
+++ o Excel não envia os dados imediatamente, apenas quando há uma mudança
